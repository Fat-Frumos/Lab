<!DOCTYPE html>
<html lang="en">

<head>
    <title>Host</title>
    <style>
        button, input {
            width: 130px;
            height: 30px;
            border-radius: 5px;
        }

        .green {
            background-color: rgba(76, 175, 80, 0.5);
        }

        .blue {
            background-color: rgba(33, 150, 243, 0.5);
        }

        .red {
            background-color: rgba(250, 0, 0, 0.5);
        }

        .orange {
            background-color: rgba(255, 165, 0, 0.5);
        }

        .gray {
            background-color: rgba(189, 189, 189, 0.5);
        }
    </style>
</head>

<body>
    <button onclick="createButtons()">host</button>
    <script>
        function getLabel(url) {
            return url.split("/").slice(3).join("/");
        }

        function createButtons() {
            var regex = /"href":\s*"([^"]+)"/g;
            fetch("http://localhost:8080/api/certificates")
                .then(response => response.json())
                .then(data => {
                    var matches;
                    var urls = [];
                    var tagsUrls = [];
                    var usersUrls = [];
                    var delUrls = [];
                    var list = data._embedded

                    for (const key in list) {
                        if (Object.hasOwnProperty.call(list, key)) {
                            const element = list[key];
                            for (const key in element) {
                                if (Object.hasOwnProperty.call(element, key)) {
                                    const el = element[key];
                                    for (const key in el._links) {
                                        if (key === "tags") {
                                            tagsUrls.push(el._links[key]);
                                        }
                                        if (key === "user") {
                                            usersUrls.push(el._links[key]);
                                        }
                                        if (key === "delete") {
                                            delUrls.push(el._links[key]);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    createButtonsWithColor(delUrls, "green");
                    createButtonsWithColor(tagsUrls, "orange");
                    createButtonsWithColor(usersUrls, "blue");
                    createButtonsWithColor(delUrls, "red");
                })
                .catch(error => console.error(error));
        }

        function createButtonsWithColor(urls, color) {
            urls.forEach(url => {
                var idRegex = /\/(\d+)$/g;
                var urlStr = url.href;
                var idMatch = idRegex.exec(urlStr);
                var id = idMatch ? idMatch[1] : "";
                if (color === "red") {
                    var form = document.createElement("form");
                    form.setAttribute("method", "DELETE");
                    form.setAttribute("action", urlStr);
                    form.style.display = "inline";
                    var button = document.createElement("input");
                    button.setAttribute("type", "submit");
                    button.setAttribute("value", getLabel(urlStr).replaceAll("api/", "").replaceAll("certificates/", ""));
                    button.style.backgroundColor = color || "transparent";
                    form.appendChild(button);
                    document.body.appendChild(form);
                } else {
                    createButton(urlStr, getLabel(urlStr), color, id);
                }
            });
        }

        createButtonsWithColor(selfUrls, "green");
        createButtonsWithColor(tagsUrls, "orange");
        createButtonsWithColor(usersUrls, "blue");
        createButtonsWithColor(delUrls, "red");

        function createButton(url, label, color, id) {
            var button = document.createElement("button");
            button.textContent = label.replaceAll("api/", "").replaceAll("certificates/", "");
            button.className = color || "transparent";
            button.addEventListener("click", function () {
                window.open(url);
            });
            button.setAttribute("data-id", id);
            // var idRegex = /\/(\d+)$/g;
            document.body.appendChild(button);
        }
    </script>
</body>
</html>